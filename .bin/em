#!/bin/bash

# Emoji Manager

normalizeString() {
    echo "$1" | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
}

char2emoji() {
    local letter="$1";
    local offset;
    local a_ascii=65
    local idx;
    local a_emoji=0x1F1E6;

    if [ "$letter" = " " ]; then
        # Space, so add additional spaces to help separate the emojis
        echo "   ";
        return;
    elif [ "$letter" = "?" ]; then
        echo "\U00002754";
        return;
    elif [ "$letter" = "!" ]; then
        echo "\U00002755";
        return;
    elif ! echo "$letter" | grep -q "^[A-Z]$"; then
        echo "$letter";
        return;
    fi

    offset="$(printf "%d" "'$letter")";

    idx=$((offset-a_ascii))

    printf "\\\U000%x" "$((a_emoji+idx))"
}

emojify() {
    local string="$1"
    local char;
    local ret="";

    string="$(normalizeString "$string")"

    for (( i=1; i<=${#string}; i++ )); do
        char="$(printf '%s\n' "$string" | cut -c${i})"

        ret="${ret} $(char2emoji "$char")"
    done

    echo -e "$ret"
}

emojis="$(cat <<EOF
Emojify String
Get Current Time

100 points perfect a+       - ðŸ’¯
among us                    - ðŸ¤«ðŸ‘¨â€ðŸš€ðŸ”«
angry livid mad             - ðŸ˜ 
car vehicle                 - ðŸš—
check correct tick          - âœ…
confused                    - ðŸ˜•
cross wrong x               - âŒ
crying                      - ðŸ˜¢
disappointed sad            - ðŸ˜ž
drooling                    - ðŸ¤¤
exclamation mark            - â•
expressionless ughh         - ðŸ˜‘
eye roll rolling            - ðŸ™„
facepalm                    - ðŸ¤¦
fingers crossed             - ðŸ¤ž
fist bump                   - ðŸ¤œðŸ¤›
fist bump distance          - ðŸ¤œ        ðŸ¤›
grinning open smile         - ðŸ˜€
laugh cry                   - ðŸ˜‚
loudly crying               - ðŸ˜­
middle finger               - ðŸ–•
moo cow                     - ðŸ„
nerd face                   - ðŸ¤“
neutral face oops           - ðŸ˜
ok okay perfect             - ðŸ‘Œ
pointing down               - ðŸ‘‡
pointing up                 - ðŸ‘†
poop                        - ðŸ’©
question mark               - â”
raised eyebrow              - ðŸ¤¨
rofl rolling floor laughing - ðŸ¤£
savoring delicious tasty    - ðŸ˜‹
sleep zzz boring tired      - ðŸ’¤
snake                       - ðŸ
squinting happy tongue      - ðŸ˜
sunglasses cool confident   - ðŸ˜Ž
thinking hmm                - ðŸ¤”
thumbs down                 - ðŸ‘Ž
thumbs up                   - ðŸ‘
tongue out                  - ðŸ˜›
trex                        - ðŸ¦–
vulcan salute greetings     - ðŸ––
winking                     - ðŸ˜‰
winking tongue              - ðŸ˜œ
wrench tool                 - ðŸ”§
zaney silly tongue          - ðŸ¤ª

12:00 - ðŸ•›
12:30 - ðŸ•§
1:00  - ðŸ•
1:30  - ðŸ•œ
2:00  - ðŸ•‘
2:30  - ðŸ•
3:00  - ðŸ•’
3:30  - ðŸ•ž
4:00  - ðŸ•“
4:30  - ðŸ•Ÿ
5:00  - ðŸ•”
5:30  - ðŸ• 
6:00  - ðŸ••
6:30  - ðŸ•¡
7:00  - ðŸ•–
7:30  - ðŸ•¢
8:00  - ðŸ•—
8:30  - ðŸ•£
9:00  - ðŸ•˜
9:30  - ðŸ•¤
10:00 - ðŸ•™
10:30 - ðŸ•¥
11:00 - ðŸ•š
11:30 - ðŸ•¦

canada flag                 - ðŸ‡¨ðŸ‡¦
united kingdom flag         - ðŸ‡¬ðŸ‡§
united states american flag - ðŸ‡ºðŸ‡¸

confused                 - ã€Œ(Â°ãƒ˜Â°)
confused shrug           - Â¯\(Â°_o)/Â¯
crying                   - à¼¼ à¼Žàº¶ à·´ à¼Žàº¶à¼½
flipping table           - (â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»
happy                    - (âœ¿â— â€¿â— )
i see what you did there - (Í¡Â° ÍœÊ– Í¡Â°)
middle finger            - (å‡¸à² ç›Šà² )å‡¸
shifty eyes              - (Â¬ï½¤Â¬)
shrug                    - Â¯\_(ãƒ„)_/Â¯
surprised                - (ï¾‰ï¾Ÿ0ï¾Ÿ)ï¾‰

degrees - Â°
EOF
)"

choice="$(echo -e "$emojis" | dmenu -i -l 20 -c)";

if [ "$choice" = "" ]; then
    exit 0;
elif [ "$choice" = "Emojify String" ]; then
    string="$(echo "" | dmenu -c -i -p "Enter a String: ")";

    if [ "$string" = "" ]; then
        exit 0;
    fi

    toCopy="$(emojify "$string")"
elif [ "$choice" = "Get Current Time" ]; then
    hour="$(date '+%-l')"
    min="$(date '+%M')"

    if [ "$min" -lt 15 ]; then
        min="00";
    elif [ "$min" -lt 45 ]; then
        min="30";
    elif [ "$min" -le 59 ]; then
        min="00";
        hour=$((hour+1))
    fi

    if [ "$hour" -gt 12 ]; then
        hour=1
    fi

    time="${hour}:${min}";

    choice="$(echo -e "$emojis" | env grep -F "${time}")"

    toCopy="$(echo "$choice" | awk -F' *- *' '{ print $2 }')";
else
    toCopy="$(echo "$choice" | awk -F' *- *' '{ print $2 }')";
fi

echo "$toCopy" | tr -d "\n" | xclip -sel clip;
