#!/bin/bash

# Emoji Manager

normalizeString() {
    echo "$1" | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
}

char2emoji() {
    local letter="$1";
    local offset;
    local a_ascii=65
    local idx;
    local a_emoji=0x1F1E6;

    if [ "$letter" = " " ]; then
        # Space, so add additional spaces to help separate the emojis
        echo "   ";
        return;
    elif [ "$letter" = "?" ]; then
        echo "\U00002754";
        return;
    elif [ "$letter" = "!" ]; then
        echo "\U00002755";
        return;
    elif ! echo "$letter" | grep -q "^[A-Z]$"; then
        echo "$letter";
        return;
    fi

    offset="$(printf "%d" "'$letter")";

    idx=$((offset-a_ascii))

    printf "\\\U000%x" "$((a_emoji+idx))"
}

emojify() {
    local string="$1"
    local char;
    local ret="";

    string="$(normalizeString "$string")"

    for (( i=1; i<=${#string}; i++ )); do
        char="$(printf '%s\n' "$string" | cut -c${i})"

        ret="${ret} $(char2emoji "$char")"
    done

    echo -e "$ret"
}

emojis="$(cat <<EOF
Emojify String
Canada Flag                 - \U0001F1E8\U0001F1E6
Check correct tick          - âœ”ï¸
Confused                    - ã€Œ(Â°ãƒ˜Â°)
Confused                    - ðŸ˜•
Confused shrug              - Â¯\(Â°_o)/Â¯
Cross wrong x               - âŒ
Crying                      - à¼¼ à¼Žàº¶ à·´ à¼Žàº¶à¼½
Crying                      - ðŸ˜¢
Degrees                     - Â°
Disappointed Sad            - ðŸ˜ž
Exclamation Mark            - \U00002755
Facepalm                    - ðŸ¤¦
Fingers crossed             - ðŸ¤ž
Fist Bump                   - ðŸ¤œðŸ¤›
Fist Bump Distance          - ðŸ¤œ        ðŸ¤›
Flipping Table              - (â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»
Happy                       - (âœ¿â— â€¿â— )
I see what you did there    - (Í¡Â° ÍœÊ– Í¡Â°)
Laugh Cry                   - ðŸ˜‚
Loudly Crying               - ðŸ˜­
Middle Finger               - (å‡¸à² ç›Šà² )å‡¸
Middle Finger               - ðŸ–•
OK okay Perfect             - ðŸ‘Œ
Pointing down               - ðŸ‘‡
Pointing up                 - â˜ï¸
Poop                        - ðŸ’©
Question Mark               - \U00002754
Shifty Eyes                 - (Â¬ï½¤Â¬)
Shrug                       - Â¯\_(ãƒ„)_/Â¯
Sleep Zzz boring tired      - ðŸ’¤
Surprised                   - (ï¾‰ï¾Ÿ0ï¾Ÿ)ï¾‰
Thumbs Up                   - ðŸ‘
Thumbs down                 - ðŸ‘Ž
United Kingdom Flag         - \U0001F1EC\U0001F1E7
United States American Flag - \U0001F1FA\U0001F1F8
Vulcan salute greetings     - ðŸ––
EOF
)"

choice="$(echo -e "$emojis" | dmenu -i -l 10)";

if [ "$choice" = "" ]; then
    exit 0;
elif [ "$choice" = "Emojify String" ]; then
    string="$(echo "" | dmenu -i -p "Enter a String: ")";

    if [ "$string" = "" ]; then
        exit 0;
    fi

    toCopy="$(emojify "$string")"
else
    toCopy="$(echo "$choice" | awk -F' *- *' '{ print $2 }')";
fi

echo "$toCopy" | tr -d "\n" | xclip -sel clip;
